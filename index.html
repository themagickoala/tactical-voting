<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tactical Voting POC</title>
    </head>
    <body>
        <form action="" method="POST">
            <label for=postcode>Postcode</label>
            <input id=postcode name=postcode type=text>
        </form>
        <pre><code id=newpostcode></code></pre>
        <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
        <script type="text/javascript">
            $(() => {
                $('form').submit((e) => {
                    const val = $('#postcode').val();
                    $.get('https://mapit.mysociety.org/postcode/' + val.replace(/\s/g, '')).done((result) => {
                        const wmc = result.shortcuts.WMC;
                        const area = result.areas[wmc];
                        const gss = area.codes.gss;

                        $.get('data/recommendations.json').done((recommendations) => {
                            const constituency = recommendations.find(r => r.id === gss);
                            if (constituency) {
                                $('#newpostcode').text("Constituency: " + constituency.Constituency);
                            } else {
                                $('#newpostcode').text("Could not find constituency");
                            }
                        })
                    });
                    return false;
                });
            });
        </script>
    </body>
</html>